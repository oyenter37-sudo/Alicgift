<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, –ê–ª–∏—Å–∞!</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Pacifico&display=swap');

  /* [–ü–†–û–¢–û–ö–û–õ: –ê–ù–¢–ò-–í–´–î–ï–õ–ï–ù–ò–ï] */
  *{
    margin:0;padding:0;box-sizing:border-box;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    user-select: none;
  }

  body{
    font-family:'Montserrat',sans-serif;
    overflow:hidden;
    width:100vw;height:100vh;
    background:#0b1d2a;
  }

  .screen{
    display:none;flex-direction:column;align-items:center;justify-content:center;
    width:100vw;height:100vh;position:fixed;top:0;left:0;z-index:1;
  }
  .screen.active{display:flex}
  .black-screen{background:#000}

  /* --- –ö–Ω–æ–ø–∫–∏ (Juicy UI) --- */
  .btn{
    padding:16px 48px;font-size:1.1rem;font-weight:700;border:none;border-radius:50px;
    cursor:pointer;position:relative;z-index:2;margin-top:30px;
    transition:transform .2s,box-shadow .2s;text-transform:uppercase;letter-spacing:2px;
    outline: none;
  }
  .btn:hover{transform:translateY(-3px) scale(1.05)}
  .btn:active{transform:translateY(0) scale(.98)}
  .btn:disabled{opacity:0.6; cursor:not-allowed; transform:none;}

  .btn-primary{
    background:linear-gradient(135deg,#ff6f61,#ff9a76);color:#fff;
    box-shadow:0 8px 25px rgba(255,111,97,.4);
  }
  .btn-gold{
    background:linear-gradient(135deg,#ffd700,#ffaa00);color:#1a0a00;
    box-shadow:0 8px 25px rgba(255,215,0,.4);
  }
  .btn-green{
    background:linear-gradient(135deg,#00e6a0,#00c9a7);color:#fff;
    box-shadow:0 8px 25px rgba(0,230,160,.4);
  }

  /* ===== –ó–ê–°–¢–ê–í–ö–ê (–í–û–°–°–¢–ê–ù–û–í–õ–ï–ù –î–ï–ö–û–†) ===== */
  #screen-splash{
    background:linear-gradient(150deg,#0b1d2a,#14303f 40%,#1a3d4f 70%,#0b1d2a);
    text-align:center;overflow:hidden;
  }
  .splash-bg-circles{position:absolute;width:100%;height:100%;top:0;left:0;z-index:0;overflow:hidden}
  .circle{position:absolute;border-radius:50%;opacity:.07;will-change:transform}
  .circle:nth-child(1){width:400px;height:400px;background:#ff6f61;top:-100px;left:-100px;animation:floatC 12s ease-in-out infinite}
  .circle:nth-child(2){width:300px;height:300px;background:#00d4aa;bottom:-50px;right:-80px;animation:floatC 10s ease-in-out infinite reverse}
  .circle:nth-child(3){width:200px;height:200px;background:#ffd700;top:30%;right:10%;animation:floatC 8s ease-in-out infinite 2s}
  @keyframes floatC{ 0%,100%{transform:translate(0,0) scale(1)} 33%{transform:translate(30px,-20px) scale(1.1)} 66%{transform:translate(-20px,15px) scale(.95)} }

  .splash-stars{position:absolute;width:100%;height:100%;top:0;left:0;z-index:1}
  .star{
    position:absolute;width:3px;height:3px;background:#fff;border-radius:50%;
    will-change:opacity,transform;animation:twink 2s ease-in-out infinite;
  }
  .star.big{width:5px;height:5px;box-shadow:0 0 6px 2px rgba(255,255,255,.3)}
  @keyframes twink{0%,100%{opacity:.15;transform:scale(1)}50%{opacity:1;transform:scale(1.4)}}

  .splash-emoji-row{
    display:flex;gap:20px;font-size:clamp(2rem,6vw,3.5rem);
    margin-bottom:10px;position:relative;z-index:2;
    animation:ePop 1s ease-out .3s both;
  }
  .splash-emoji-row span{animation:eFloat 3s ease-in-out infinite}
  .splash-emoji-row span:nth-child(2){animation-delay:.5s}
  .splash-emoji-row span:nth-child(3){animation-delay:1s}
  @keyframes eFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
  @keyframes ePop{0%{opacity:0;transform:scale(0) rotate(-15deg)}60%{transform:scale(1.2) rotate(3deg)}100%{opacity:1;transform:scale(1) rotate(0)}}

  .splash-title{
    font-family:'Pacifico',cursive;font-size:clamp(2rem,7vw,4.5rem);color:#fff;
    text-shadow:0 0 25px rgba(255,111,97,.5),0 4px 12px rgba(0,0,0,.4);
    animation:tFloat 3s ease-in-out infinite,tAppear 1.2s ease-out;
    position:relative;z-index:2;line-height:1.3;padding:0 20px;
  }
  @keyframes tFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
  @keyframes tAppear{0%{opacity:0;transform:scale(.5) translateY(40px)}100%{opacity:1;transform:scale(1) translateY(0)}}
  .splash-subtitle{position:relative;z-index:2;color:rgba(255,255,255,.5);font-size:.95rem;margin-top:12px;letter-spacing:3px;text-transform:uppercase}
  .splash-date{position:relative;z-index:2;color:#ffd700;font-weight:700;font-size:1rem;margin-top:6px;text-shadow:0 0 10px rgba(255,215,0,.3)}
  .splash-bottom-decor{position:absolute;bottom:30px;display:flex;gap:15px;z-index:2;opacity:.3;font-size:1.5rem}

  /* ===== –ü–û–ñ–ï–õ–ê–ù–ò–Ø ===== */
  #screen-wishes{
    background:linear-gradient(150deg,#0b1d2a,#163040 50%,#0b1d2a);
    padding:30px 20px;gap:20px;overflow-y:auto;
  }
  .wishes-header{text-align:center;position:relative;z-index:2}
  .wishes-icon{font-size:2.5rem;margin-bottom:5px}
  .wishes-title{font-family:'Pacifico',cursive;font-size:clamp(1.4rem,4vw,2.2rem);color:#ffd700;text-shadow:0 0 15px rgba(255,215,0,.4)}
  .wishes-line{width:60px;height:3px;background:linear-gradient(90deg,transparent,#ff6f61,transparent);border-radius:2px;margin:8px auto 0}
  .wish-card{
    background:rgba(255,255,255,.05);backdrop-filter:blur(15px);
    border:1px solid rgba(255,255,255,.08);border-radius:20px;
    padding:28px 30px;max-width:500px;width:90%;color:#fff;
    font-size:1.05rem;line-height:1.7;position:relative;overflow:hidden;
    animation:cardIn .8s ease-out both;text-align:center;
  }
  .wish-card:nth-child(3){animation-delay:.3s}
  @keyframes cardIn{0%{opacity:0;transform:translateY(30px) scale(.95)}100%{opacity:1;transform:translateY(0) scale(1)}}
  .wish-card::after{ content:'';position:absolute;top:0;left:-100%;width:100%;height:100%; background:linear-gradient(90deg,transparent,rgba(255,255,255,.04),transparent); animation:shimmer 4s ease-in-out infinite; }
  @keyframes shimmer{0%{left:-100%}100%{left:100%}}
  .wish-number{
    display:inline-flex;align-items:center;justify-content:center;
    width:38px;height:38px;background:linear-gradient(135deg,#ff6f61,#ff9a76);
    border-radius:50%;font-weight:900;font-size:.9rem;margin-bottom:14px;
    box-shadow:0 4px 15px rgba(255,111,97,.3);
  }
  .wish-card-emoji{position:absolute;top:14px;right:18px;font-size:1.3rem;opacity:.5}

  /* ===== –í–ò–î–ï–û ===== */
  #screen-video{background:linear-gradient(150deg,#0b1d2a,#163040);text-align:center;gap:25px}
  .video-section-title{color:#ffd700;font-family:'Pacifico',cursive;font-size:1.5rem;text-shadow:0 0 10px rgba(255,215,0,.3)}
  .video-placeholder{
    width:90%;max-width:560px;aspect-ratio:16/9;
    background:rgba(255,255,255,.04);border:2px dashed rgba(255,255,255,.15);
    border-radius:20px;display:flex;flex-direction:column;align-items:center;
    justify-content:center;color:rgba(255,255,255,.5);font-size:1.1rem;gap:12px;
    position: relative; overflow: hidden;
  }
  .play-icon{ width:70px;height:70px;background:rgba(255,111,97,.2);border:2px solid rgba(255,111,97,.4); border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem; animation:playP 2s ease-in-out infinite; }
  @keyframes playP{0%,100%{transform:scale(1);box-shadow:0 0 0 rgba(255,111,97,0)}50%{transform:scale(1.05);box-shadow:0 0 20px rgba(255,111,97,.3)}}

  /* ===== –°–õ–û–¢–´ ===== */
  #screen-slots{ background:linear-gradient(150deg,#1a0f05,#2d1a0a 30%,#1a0f05); text-align:center;gap:18px;overflow:hidden; }
  .slots-title{color:rgba(255,215,0,.6);font-size:.85rem;letter-spacing:4px;text-transform:uppercase}
  .slots-frame{
    background:linear-gradient(180deg,#1f1208,#150d05);border:4px solid #ffd700;
    border-radius:20px;padding:25px 30px 18px;
    box-shadow:0 0 40px rgba(255,215,0,.15),inset 0 0 30px rgba(0,0,0,.5);position:relative;
  }
  .slots-frame-label{
    position:absolute;top:-16px;left:50%;transform:translateX(-50%);
    background:linear-gradient(135deg,#ffd700,#ffaa00);color:#1a0a00;
    padding:5px 22px;border-radius:20px;font-weight:900;font-size:.85rem;
    letter-spacing:3px;white-space:nowrap;box-shadow:0 4px 15px rgba(255,215,0,.3);
  }
  .slots-container{display:flex;gap:12px;margin-top:10px}
  .slot-reel-wrapper{
    width:90px;height:110px;overflow:hidden;
    background:linear-gradient(180deg,#fffef5,#fff8e1);border-radius:12px;
    border:3px solid #b8860b;position:relative;box-shadow:inset 0 0 15px rgba(0,0,0,.15);
  }
  .slot-reel-wrapper::before,.slot-reel-wrapper::after{ content:'';position:absolute;left:0;right:0;height:20px;z-index:2;pointer-events:none; }
  .slot-reel-wrapper::before{top:0;background:linear-gradient(180deg,rgba(255,252,240,.95),transparent)}
  .slot-reel-wrapper::after{bottom:0;background:linear-gradient(0deg,rgba(255,252,240,.95),transparent)}
  .slot-reel{display:flex;flex-direction:column;align-items:center}
  .slot-symbol{width:90px;height:110px;display:flex;align-items:center;justify-content:center;font-size:3.5rem;flex-shrink:0}
  .jackpot-text{ display:none;font-size:clamp(2rem,8vw,3.5rem);font-weight:900;color:#ffd700; text-shadow:0 0 25px rgba(255,215,0,.8),0 0 50px rgba(255,215,0,.3); animation:jpPulse .5s ease-in-out infinite alternate; }
  .jackpot-text.visible{display:block}
  @keyframes jpPulse{0%{transform:scale(1)}100%{transform:scale(1.06);text-shadow:0 0 40px rgba(255,215,0,1)}}

  /* ===== –ü–û–î–ê–†–û–ö (15 –ö–õ–ò–ö–û–í) ===== */
  #screen-gift{ background:linear-gradient(150deg,#0b1d2a,#163040 50%,#0b1d2a); text-align:center;gap:16px;cursor:pointer;overflow:hidden; outline: none; }
  .gift-instruction{color:rgba(255,255,255,.7);font-size:1.05rem;position:relative;z-index:2}
  .gift-counter{color:#ffd700;font-size:1.2rem;font-weight:700;min-height:30px}
  .gift-progress{ display:flex;gap:6px;position:relative;z-index:2; flex-wrap: wrap; justify-content: center; max-width: 300px; }
  .gift-progress-dot{ width:12px;height:12px;border-radius:50%; background:rgba(255,255,255,.1);border:2px solid rgba(255,255,255,.2); transition:all .3s; }
  .gift-progress-dot.filled{background:#ff6f61;border-color:#ff6f61;box-shadow:0 0 10px rgba(255,111,97,.5)}
  .gift-box-container{position:relative;width:200px;height:230px;z-index:2; outline:none;}
  .new-emoji-gift { width: 150px; height: 150px; background: transparent !important; box-shadow: none !important; border: none !important; margin: 0 auto; display: flex; align-items: center; justify-content: center; z-index: 10; }
  .super-gift-emoji { font-size: 9rem; line-height: 1; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.6)); transition: transform 0.3s; }
  .gift-box.shake{animation:gShake .3s ease-in-out}
  @keyframes gShake{ 0%,100%{transform:rotate(0) scale(1)} 20%{transform:rotate(8deg) scale(1.06)} 40%{transform:rotate(-8deg)} }
  .gift-opened .super-gift-emoji { animation: giftOpenAnim 0.7s forwards; }
  @keyframes giftOpenAnim { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0) translateY(-100px); opacity: 0; } }
  .gift-content{ display:none;position:absolute;top:-30px;left:50%;transform:translateX(-50%); animation:gReveal .8s ease-out;z-index:5; }
  .gift-content.visible{display:block}
  .hedgehog-emoji-mode { background: transparent !important; border: none !important; box-shadow: none !important; }
  .giant-hedgehog { font-size: 8rem; filter: drop-shadow(0 0 35px rgba(255,215,0,0.9)); animation: hedgehogFloat 2.5s ease-in-out infinite; }
  @keyframes hedgehogFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

  /* ===== [–ù–û–í–û–ï] –†–ò–°–û–í–ê–ù–ò–ï –°–í–ï–¢–û–ú (MAGIC SPARKS) ===== */
  #screen-draw { background: #000; text-align: center; }
  #drawing-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; touch-action: none; cursor: crosshair; }
  .draw-ui { position: relative; z-index: 10; pointer-events: none; height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 40px 20px; }
  .draw-title { font-family: 'Pacifico', cursive; font-size: 2rem; color: #ffd700; text-shadow: 0 0 20px rgba(255,215,0,0.6); pointer-events: auto; }
  .draw-actions { pointer-events: auto; }

  /* ===== –§–ò–ù–ê–õ ===== */
  #screen-final{ background:linear-gradient(150deg,#0b1d2a,#163040 50%,#0b1d2a); text-align:center;gap:15px; overflow-y:auto; padding: 20px 0; }
  .final-text{font-family:'Pacifico',cursive;font-size:clamp(1.5rem,5vw,2.5rem);color:#fff;text-shadow:0 0 20px rgba(255,111,97,.5)}
  .message-box { margin-top: 15px; width: 90%; max-width: 400px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 20px; backdrop-filter: blur(10px); }
  .glass-textarea { width: 100%; height: 80px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 12px; color: #fff; font-family: inherit; font-size: 0.95rem; resize: none; outline: none; }
  .msg-status-text { display: none; color: #00e6a0; font-weight: 900; font-size: 1.2rem; }
  
  /* –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞ */
  @keyframes screenShakeJuice { 0%, 100% { transform: translate(0,0); } 20% { transform: translate(-5px, 5px); } 40% { transform: translate(5px, -5px); } }
  .click-particle { position: fixed; pointer-events: none; z-index: 9999; animation: particleOut 0.7s forwards; }
  @keyframes particleOut { 0% { opacity: 1; transform: scale(0.3); } 100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.5); } }
</style>
</head>
<body>

<!-- –ó–ê–°–¢–ê–í–ö–ê -->
<div id="screen-splash" class="screen active">
  <div class="splash-bg-circles"><div class="circle"></div><div class="circle"></div><div class="circle"></div></div>
  <div class="splash-stars" id="stars"></div>
  <div class="splash-emoji-row"><span>üéÇ</span><span>üéâ</span><span>üéà</span></div>
  <h1 class="splash-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
  <div class="splash-subtitle">–æ—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞</div>
  <div class="splash-date">üóì 2026</div>
  <button class="btn btn-primary" id="btn-start">‚ú® –ù–∞—á–∞—Ç—å</button>
  <div class="splash-bottom-decor">‚≠ê ‚≠ê ‚≠ê ‚≠ê ‚≠ê</div>
</div>

<!-- –ü–û–ñ–ï–õ–ê–ù–ò–Ø -->
<div id="screen-wishes" class="screen">
  <div class="wishes-header">
    <div class="wishes-icon">üìú</div>
    <div class="wishes-title">–ü–æ–∂–µ–ª–∞–Ω–∏—è</div>
    <div class="wishes-line"></div>
  </div>
  <div class="wish-card">
    <span class="wish-card-emoji">üå∏</span>
    <div class="wish-number">1</div>
    <p class="wish-text-p">–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è! ‚ú®</p>
  </div>
  <div class="wish-card">
    <span class="wish-card-emoji">üå∫</span>
    <div class="wish-number">2</div>
    <p class="wish-text-p">–ü—É—Å—Ç—å —Å–±—ã–≤–∞—é—Ç—Å—è –º–µ—á—Ç—ã! üöÄ</p>
  </div>
  <button class="btn btn-primary" id="btn-wishes-next">–î–∞–ª–µ–µ ‚Üí</button>
</div>

<div id="screen-black1" class="screen black-screen"></div>

<!-- –í–ò–î–ï–û -->
<div id="screen-video" class="screen">
  <div class="video-section-title">üé¨ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ–ª–∏–∫</div>
  <div class="video-placeholder" id="video-placeholder-container">
    <video id="cat-video" controls style="display:none; width:100%; height:100%; border-radius:18px; object-fit:cover; position:absolute; top:0; left:0; z-index: 2;"></video>
    <div id="video-fallback-content" style="display:flex; flex-direction:column; align-items:center; justify-content:center; width: 100%; height: 100%; z-index: 1;">
      <div class="play-icon">‚ñ∂</div>
      <div id="video-fallback-text">–¢—É—Ç –±—É–¥–µ—Ç –≤–∏–¥–µ–æ —Å –∫–æ—Ç–∞–º–∏ üê±</div>
    </div>
  </div>
  <button class="btn btn-primary" id="btn-skip-video">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚è≠</button>
</div>

<div id="screen-black2" class="screen black-screen"></div>

<!-- –°–õ–û–¢–´ -->
<div id="screen-slots" class="screen">
  <div class="slots-title">üé≤ MEGA SLOTS üé≤</div>
  <div class="slots-frame">
    <div class="slots-frame-label">JACKPOT AWAITS</div>
    <div class="slots-container">
      <div class="slot-reel-wrapper"><div class="slot-reel" id="reel1"></div></div>
      <div class="slot-reel-wrapper"><div class="slot-reel" id="reel2"></div></div>
      <div class="slot-reel-wrapper"><div class="slot-reel" id="reel3"></div></div>
    </div>
  </div>
  <button class="btn btn-gold" id="btn-spin">üé∞ –ö–†–£–¢–ò–¢–¨</button>
  <div class="jackpot-text" id="jackpot-text">üèÜ 777 üèÜ</div>
  <button class="btn btn-green" id="btn-claim">üéÅ –ó–ê–ë–†–ê–¢–¨ –ü–†–ò–ó</button>
</div>

<!-- –ü–û–î–ê–†–û–ö (15 –ö–õ–ò–ö–û–í) -->
<div id="screen-gift" class="screen">
  <div class="gift-instruction">–ë—ã—Å—Ç—Ä–æ –Ω–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å! üéÅ</div>
  <div class="gift-counter" id="gift-counter">–û—Å—Ç–∞–ª–æ—Å—å –∫–ª–∏–∫–æ–≤: 15</div>
  <div class="gift-progress" id="gift-progress"></div>
  <div class="gift-box-container" id="gift-box-container">
    <div class="gift-box new-emoji-gift" id="gift-box">
      <div class="super-gift-emoji" id="super-gift-emoji">üéÅ</div>
    </div>
    <div class="gift-content" id="gift-content">
      <div class="hedgehog-placeholder hedgehog-emoji-mode">
        <div id="prize-emoji" class="giant-hedgehog">ü¶î</div>
      </div>
    </div>
  </div>
  <button class="btn btn-primary" id="btn-gift-next" style="display:none">–î–∞–ª–µ–µ ‚Üí</button>
</div>

<!-- –†–ò–°–û–í–ê–ù–ò–ï –°–í–ï–¢–û–ú (MAGIC SPARKS) -->
<div id="screen-draw" class="screen">
    <canvas id="drawing-canvas"></canvas>
    <div class="draw-ui">
        <div>
            <h2 class="draw-title">–ù–∞—Ä–∏—Å—É–π —á—Ç–æ-–Ω–∏–±—É–¥—å ‚ú®</h2>
        </div>
        <div class="draw-actions">
            <button class="btn btn-primary" id="btn-draw-next">–î–∞–ª–µ–µ ‚Üí</button>
        </div>
    </div>
</div>

<!-- –§–ò–ù–ê–õ -->
<div id="screen-final" class="screen">
  <div class="final-text">–° –î–Ω—ë–º –†–æ–∂–¥–µ–Ω–∏—è, –ê–ª–∏—Å–∞! üéâ</div>
  <div class="message-box" id="msg-box-container">
    <div class="message-title" id="msg-title">–ù–∞–ø–∏—à–∏ –º–Ω–µ –ø–∞—Ä—É —Å–ª–æ–≤! üíå</div>
    <textarea class="glass-textarea" id="alice-message" placeholder="–¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
    <div class="msg-status-text" id="msg-status-text">–°–æ–æ–±—â–µ–Ω–∏–µ —É–ª–µ—Ç–µ–ª–æ! ‚ú®</div>
    <button class="btn btn-green" id="btn-send-msg" style="margin-top:15px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å üöÄ</button>
  </div>
  <button class="btn btn-primary" id="btn-close">–ó–∞–∫—Ä—ã—Ç—å üéâ</button>
</div>

<script>
// [–ü–†–û–¢–û–ö–û–õ: –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø]
let CONFIG = { clicksToOpenGift: 15, giftEmoji: 'üéÅ', prizeEmoji: 'ü¶î' };
const $=id=>document.getElementById(id);
const $$=s=>document.querySelectorAll(s);

// [–ü–†–û–¢–û–ö–û–õ: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï]
function logAction(eventText) {
  fetch('/api/index', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'logAction', event: eventText })
  }).catch(()=>{});
}

// [–ü–†–û–¢–û–ö–û–õ: –ó–ê–ì–†–£–ó–ö–ê –ò–ó –ë–î]
async function loadLiveConfig() {
  try {
    const res = await fetch('/api/index?action=getConfig');
    const data = await res.json();
    if(data.success && data.config) {
      if(data.config.clicksToOpenGift) CONFIG.clicksToOpenGift = parseInt(data.config.clicksToOpenGift);
      if(data.config.giftEmoji) CONFIG.giftEmoji = data.config.giftEmoji;
      if(data.config.prizeEmoji) CONFIG.prizeEmoji = data.config.prizeEmoji;
      if(data.config.splashTitle) $$('.splash-title')[0].innerHTML = data.config.splashTitle;
      const wishCards = $$('.wish-text-p');
      if(wishCards[0] && data.config.wish1) wishCards[0].innerHTML = data.config.wish1;
      if(wishCards[1] && data.config.wish2) wishCards[1].innerHTML = data.config.wish2;
    }
  } catch(e) { console.log('–ò—Å–ø–æ–ª—å–∑—É—é –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à.'); }
  applyConfigToUI();
}

function applyConfigToUI() {
    $('gift-counter').textContent = `–û—Å—Ç–∞–ª–æ—Å—å –∫–ª–∏–∫–æ–≤: ${CONFIG.clicksToOpenGift}`;
    $('super-gift-emoji').textContent = CONFIG.giftEmoji;
    $('prize-emoji').textContent = CONFIG.prizeEmoji;
    const prog = $('gift-progress'); prog.innerHTML = '';
    for(let i=0; i<CONFIG.clicksToOpenGift; i++){
        const d = document.createElement('div'); d.className = 'gift-progress-dot';
        prog.appendChild(d);
    }
}
loadLiveConfig();

// [–ü–†–û–¢–û–ö–û–õ: –ú–£–ó–´–ö–ê–õ–¨–ù–´–ô –î–í–ò–ñ–û–ö]
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
let isMusicPlaying = false;
function initAudio() {
    if(!audioCtx) {
        audioCtx = new AudioCtx();
        startBackgroundMusic();
    }
}
function playTone(freq, type, duration, vol=0.1) {
    if(!audioCtx) return;
    try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    } catch(e) {} 
}
function startBackgroundMusic() {
    if(isMusicPlaying) return;
    isMusicPlaying = true;
    const notes = [261.63, 329.63, 392.00, 523.25, 392.00, 329.63]; 
    let idx = 0;
    setInterval(() => {
        playTone(notes[idx], 'triangle', 0.2, 0.03);
        idx = (idx + 1) % notes.length;
    }, 250);
}

// [–ü–†–û–¢–û–ö–û–õ: –ß–ê–°–¢–ò–¶–´ –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø]
function showScreen(id){
  $$('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
}
function showAfterBlack(b,n){
  showScreen(b); setTimeout(()=>showScreen(n), 1200);
}

function createClickParticles(x, y) {
    for(let i=0; i<8; i++) {
        const p = document.createElement('div');
        p.className = 'click-particle';
        p.textContent = '‚ú®';
        document.body.appendChild(p);
        const tx = (Math.random()-0.5)*200;
        const ty = (Math.random()-0.5)*200;
        p.style.left = x+'px'; p.style.top = y+'px';
        p.style.setProperty('--tx', tx+'px'); p.style.setProperty('--ty', ty+'px');
        setTimeout(()=>p.remove(), 700);
    }
}

// –°–æ–±—ã—Ç–∏—è –∫–Ω–æ–ø–æ–∫
$('btn-start').onclick=()=>{ initAudio(); showScreen('screen-wishes'); logAction('–°—Ç–∞—Ä—Ç'); };
$('btn-wishes-next').onclick=()=>showAfterBlack('screen-black1','screen-video');
$('btn-skip-video').onclick=()=>showAfterBlack('screen-black2','screen-slots');
$('btn-claim').onclick=()=>showScreen('screen-gift');
$('btn-gift-next').onclick=()=>{ showScreen('screen-draw'); initDraw(); logAction('–≠–∫—Ä–∞–Ω –†–∏—Å–æ–≤–∞–Ω–∏—è'); };
$('btn-draw-next').onclick=()=>{ saveDrawing(); showScreen('screen-final'); confetti({particleCount:150}); };
$('btn-close').onclick=()=>document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#fff;font-size:2rem;background:#0b1d2a">–î–æ –≤—Å—Ç—Ä–µ—á–∏! üéâ</div>';

// –í–∏–¥–µ–æ
const v = $('cat-video');
v.src = "catvidd.mp4";
v.onloadeddata = () => { $('video-fallback-content').style.display = 'none'; v.style.display = 'block'; };

// –ó–≤–µ–∑–¥—ã
(function(){
  const c=$('stars'),f=document.createDocumentFragment();
  for(let i=0;i<50;i++){
    const s=document.createElement('div');
    s.className='star'+(Math.random()>.85?' big':'');
    s.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;animation-delay:${Math.random()*4}s`;
    f.appendChild(s);
  }
  c.appendChild(f);
})();

// –°–ª–æ—Ç—ã
const syms = ['7Ô∏è‚É£','üçí','üçã','üíé','üîî','‚≠ê','üé∞'];
let reelsInit=false;
function initSlots(){
  if(reelsInit)return; reelsInit=true;
  for(let i=1;i<=3;i++){
    const r=$('reel'+i); r.innerHTML='';
    for(let j=0;j<5;j++){
      const d=document.createElement('div'); d.className='slot-symbol';
      d.textContent=syms[Math.random()*syms.length|0]; r.appendChild(d);
    }
  }
}
$('btn-spin').onclick = function(){
  initAudio(); this.disabled=true; this.style.opacity='.5';
  initSlots();
  for(let i=0;i<3;i++){
    const r=$('reel'+(i+1)), total=40+i*10;
    r.style.transition='none'; r.style.transform='translateY(0)'; r.innerHTML='';
    const f=document.createDocumentFragment();
    for(let j=0;j<total;j++){
      const d=document.createElement('div'); d.className='slot-symbol';
      d.textContent=j===total-1?'7Ô∏è‚É£':syms[Math.random()*syms.length|0]; f.appendChild(d);
    }
    r.appendChild(f);
    setTimeout(()=>{
      r.style.transition=`transform ${2+i*0.8}s cubic-bezier(.1,.9,.2,1)`;
      r.style.transform=`translateY(-${(total-1)*110}px)`;
    }, 50);
  }
  setTimeout(()=>{ $('jackpot-text').classList.add('visible'); $('btn-claim').classList.add('visible'); playTone(800,'sine',0.5); }, 4500);
};

// –ü–æ–¥–∞—Ä–æ–∫ (15 –∫–ª–∏–∫–æ–≤)
let clicks = 0;
$('gift-box-container').onclick = function(e) {
  const max = CONFIG.clicksToOpenGift;
  if(clicks >= max) return;
  clicks++;
  const dots = $$('.gift-progress-dot');
  if(dots[clicks-1]) dots[clicks-1].classList.add('filled');
  $('gift-counter').textContent = clicks < max ? `–û—Å—Ç–∞–ª–æ—Å—å –∫–ª–∏–∫–æ–≤: ${max-clicks}` : '';
  const box = $('gift-box'); box.classList.remove('shake'); void box.offsetWidth; box.classList.add('shake');
  createClickParticles(e.clientX, e.clientY); playTone(200+(clicks*30), 'square', 0.1);
  
  // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
  document.body.style.animation = 'none'; void document.body.offsetWidth;
  document.body.style.animation = 'screenShakeJuice 0.3s';

  if(clicks >= max){
    logAction('–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–∫—Ä—ã—Ç');
    setTimeout(()=>{ box.classList.add('gift-opened'); $('gift-content').classList.add('visible'); $('btn-gift-next').style.display='inline-block'; }, 400);
  }
}

/* ===== [–ò–°–ü–†–ê–í–õ–ï–ù–û] –†–ò–°–û–í–ê–ù–ò–ï –°–í–ï–¢–û–ú (MAGIC SPARKS) ===== */
let sparks = [];
let drawHistory = [];
let isDrawing = false;
const canvas = $('drawing-canvas');
const ctx = canvas.getContext('2d');

function initDraw() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    requestAnimationFrame(drawLoop);
}

function drawLoop() {
    // [–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï]: –ß–µ—Å—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —à–ª–µ–π—Ñ–∞
    ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; // –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // –†–∏—Å–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
    sparks.forEach((s, i) => {
        s.life -= 0.015; // –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —É–≥–∞—Å–∞–Ω–∏–µ
        s.x += s.vx; s.y += s.vy;
        s.vy += 0.05; // –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è

        if(s.life <= 0) {
            sparks.splice(i, 1);
        } else {
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.size * s.life, 0, Math.PI*2);
            ctx.fillStyle = `rgba(${s.c.r}, ${s.c.g}, ${s.c.b}, ${s.life})`;
            ctx.fill();
            // –°–≤–µ—á–µ–Ω–∏–µ
            ctx.shadowBlur = 10 * s.life;
            ctx.shadowColor = `rgb(${s.c.r}, ${s.c.g}, ${s.c.b})`;
        }
    });
    ctx.shadowBlur = 0;
    requestAnimationFrame(drawLoop);
}

function addSpark(x, y) {
    for(let i=0; i<3; i++) {
        sparks.push({
            x: x, y: y,
            vx: (Math.random()-0.5)*5,
            vy: (Math.random()-0.5)*5,
            size: Math.random()*4 + 2,
            life: 1.0,
            c: { r: 255, g: Math.random()*150+100, b: 0 } // –¶–≤–µ—Ç –∏—Å–∫—Ä—ã
        });
    }
}

const getPos = (e) => {
    const t = e.touches ? e.touches[0] : e;
    return { x: t.clientX, y: t.clientY };
}

const start = (e) => { 
    isDrawing = true; 
    const p = getPos(e); 
    drawHistory.push({ x: p.x/window.innerWidth, y: p.y/window.innerHeight, t: Date.now() });
};
const move = (e) => {
    if(!isDrawing) return;
    const p = getPos(e);
    addSpark(p.x, p.y);
    drawHistory.push({ x: p.x/window.innerWidth, y: p.y/window.innerHeight, t: Date.now() });
    
    // –†–∏—Å—É–µ–º –≥–æ—Ä—è—á–µ–µ —è–¥—Ä–æ –≤ –º–æ–º–µ–Ω—Ç –¥–≤–∏–∂–µ–Ω–∏—è
    ctx.beginPath();
    ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
    ctx.fillStyle = "#fff";
    ctx.fill();
};
const end = () => { isDrawing = false; };

canvas.addEventListener('mousedown', start);
canvas.addEventListener('mousemove', move);
window.addEventListener('mouseup', end);
canvas.addEventListener('touchstart', start);
canvas.addEventListener('touchmove', move);
window.addEventListener('touchend', end);

async function saveDrawing() {
    if(drawHistory.length < 5) return;
    fetch('/api/index', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'saveDrawing', pathData: JSON.stringify(drawHistory) })
    }).catch(()=>{});
}

// –ü–∏—Å—å–º–æ
$('btn-send-msg').onclick = async function() {
    const txt = $('alice-message').value.trim();
    if(!txt) return;
    this.disabled = true; this.innerHTML = "–õ–µ—Ç–∏—Ç... ‚è≥";
    await fetch('/api/index', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'sendMessage', text: txt })
    });
    $('msg-box-container').classList.add('sent-mode');
    $('alice-message').style.display = 'none'; this.style.display = 'none';
    $('msg-status-text').style.display = 'block';
    playTone(600, 'sine', 0.4);
};
</script>
</body>
  </html>
