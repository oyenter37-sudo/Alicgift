<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–¥–º–∏–Ω–∫–∞ - FINAL BOSS</title>
<style>
  body { font-family: monospace; background: #0a0a0a; color: #00ff00; padding: 20px; margin: 0; box-sizing: border-box; }
  h1 { border-bottom: 2px solid #00ff00; padding-bottom: 10px; font-size: 1.5rem; text-shadow: 0 0 10px #00ff00; }
  .box { border: 1px solid #00ff00; padding: 15px; margin-bottom: 20px; border-radius: 5px; background: #111; box-shadow: 0 0 15px rgba(0,255,0,0.1); }
  .log-entry { margin-bottom: 8px; border-bottom: 1px dashed #333; padding-bottom: 5px; font-size: 0.9rem; word-wrap: break-word; }
  .timestamp { color: #888; font-size: 0.8em; margin-right: 5px; }
  
  button { background: #00ff00; color: #000; border: none; padding: 12px 20px; cursor: pointer; font-weight: bold; border-radius: 3px; width: 100%; margin-bottom: 10px; font-size: 1rem; text-transform: uppercase; }
  button:hover { background: #00cc00; box-shadow: 0 0 10px #00ff00; }
  button:active { transform: scale(0.98); }
  
  .form-group { margin-bottom: 15px; display: flex; flex-direction: column; }
  label { font-weight: bold; margin-bottom: 5px; color: #aaa; }
  input, textarea { background: #000; border: 1px solid #00ff00; color: #00ff00; padding: 10px; font-family: monospace; border-radius: 3px; font-size: 1rem; outline: none; }
  input:focus, textarea:focus { box-shadow: 0 0 8px rgba(0,255,0,0.5); }
</style>
</head>
<body>
  <h1>üõ†Ô∏è –¢–ï–†–ú–ò–ù–ê–õ: ALICE-DB</h1>
  <button onclick="fetchAdminData()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ üîÑ</button>

  <div class="box">
    <h2>‚öôÔ∏è Live –ö–æ–Ω—Ñ–∏–≥ (–°—Ä–∞–∑—É –Ω–∞ —Å–∞–π—Ç)</h2>
    <div class="form-group">
      <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:</label>
      <input type="text" id="conf-splashTitle">
    </div>
    <div class="form-group">
      <label>–ü–æ–∂–µ–ª–∞–Ω–∏–µ 1:</label>
      <textarea id="conf-wish1" rows="2"></textarea>
    </div>
    <div class="form-group">
      <label>–ü–æ–∂–µ–ª–∞–Ω–∏–µ 2:</label>
      <textarea id="conf-wish2" rows="2"></textarea>
    </div>
    <div class="form-group">
      <label>–≠–º–æ–¥–∑–∏ –ø–æ–¥–∞—Ä–∫–∞ —Å–Ω–∞—Ä—É–∂–∏:</label>
      <input type="text" id="conf-giftEmoji">
    </div>
    <div class="form-group">
      <label>–≠–º–æ–¥–∑–∏ –ø—Ä–∏–∑–∞ –≤–Ω—É—Ç—Ä–∏:</label>
      <input type="text" id="conf-prizeEmoji">
    </div>
    <div class="form-group">
      <label>–ö–ª–∏–∫–æ–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è (—á–∏—Å–ª–æ):</label>
      <input type="number" id="conf-clicksToOpenGift">
    </div>
    <button onclick="saveConfig()" style="background: #ffcc00; color: #000;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î</button>
  </div>

  <div class="box">
    <h2>üíå –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
    <div id="messages-container">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <div class="box">
    <h2>üì° –†–∞–¥–∞—Ä –¥–µ–π—Å—Ç–≤–∏–π</h2>
    <div id="logs-container">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

<script>
const $ = id => document.getElementById(id);

async function fetchAdminData() {
  $('messages-container').innerHTML = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
  $('logs-container').innerHTML = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
  
  try {
    const res = await fetch('/api/index?action=getAdminData');
    const data = await res.json();
    
    if (data.success) {
      // –†–µ–Ω–¥–µ—Ä –ø–æ—á—Ç—ã
      renderList('messages-container', data.messages, m => `<b>–ê–ª–∏—Å–∞:</b> <span style="color:#fff">${m.text}</span>`);
      // –†–µ–Ω–¥–µ—Ä –ª–æ–≥–æ–≤
      renderList('logs-container', data.logs, l => `<span style="color:#0ff">></span> ${l.action}`);
      
      // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –∫–æ–Ω—Ñ–∏–≥–∞
      if(data.config) {
        if(data.config.splashTitle) $('conf-splashTitle').value = data.config.splashTitle;
        if(data.config.wish1) $('conf-wish1').value = data.config.wish1;
        if(data.config.wish2) $('conf-wish2').value = data.config.wish2;
        if(data.config.giftEmoji) $('conf-giftEmoji').value = data.config.giftEmoji;
        if(data.config.prizeEmoji) $('conf-prizeEmoji').value = data.config.prizeEmoji;
        if(data.config.clicksToOpenGift) $('conf-clicksToOpenGift').value = data.config.clicksToOpenGift;
      }
    }
  } catch(e) {
    $('messages-container').innerHTML = '–û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê –ö –ë–î. –ü—Ä–æ–≤–µ—Ä—å DATABASE_URL –≤ Vercel.';
  }
}

async function saveConfig() {
  const btn = event.target;
  btn.innerText = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ... ‚è≥';
  btn.disabled = true;

  const newConfig = {
    splashTitle: $('conf-splashTitle').value,
    wish1: $('conf-wish1').value,
    wish2: $('conf-wish2').value,
    giftEmoji: $('conf-giftEmoji').value,
    prizeEmoji: $('conf-prizeEmoji').value,
    clicksToOpenGift: $('conf-clicksToOpenGift').value
  };

  try {
    await fetch('/api/index', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'updateConfig', config: newConfig })
    });
    btn.innerText = '–£–°–ü–ï–®–ù–û! ‚úÖ';
    setTimeout(() => { btn.innerText = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î'; btn.disabled = false; }, 2000);
  } catch(e) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!');
    btn.innerText = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î'; btn.disabled = false;
  }
}

function renderList(id, items, formatter) {
  const container = $(id);
  container.innerHTML = '';
  if (!items || items.length === 0) {
    container.innerHTML = '–ü—É—Å—Ç–æ.';
    return;
  }
  items.forEach(item => {
    const div = document.createElement('div');
    div.className = 'log-entry';
    const time = new Date(item.created_at).toLocaleTimeString('ru-RU');
    div.innerHTML = `<span class="timestamp">[${time}]</span> ${formatter(item)}`;
    container.appendChild(div);
  });
}

// –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
fetchAdminData();
</script>
</body>
</html>
